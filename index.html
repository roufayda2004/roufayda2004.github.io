<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>مسار التعافي المتقدم من التدخين</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* CSS السابق مع إضافة تحسينات */
        .progress-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 30px;
        }
        
        .chart-box {
            background: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 15px rgba(0,0,0,0.1);
        }
        
        .achievement-badge {
            background: #3498db;
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-left: 10px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #27ae60;
            color: white;
            padding: 15px;
            border-radius: 10px;
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="notification" id="notification"></div>
        
        <h1>مسار التعافي المتقدم 🚭</h1>
        
        <div class="time-box">
            <!-- إضافة حقول جديدة -->
            <p>عدد السجائر اليومية السابقة: <input type="number" id="cigarettes" min="1" value="20"></p>
            <p>سعر العلبة (بالدولار): <input type="number" id="packPrice" min="1" value="5"></p>
            <p>تاريخ الإقلاع: <input type="datetime-local" id="quitDate"></p>
            <button onclick="startTracking()">ابدأ التتبع</button>
            <div id="elapsedTime"></div>
            <div id="savings"></div>
        </div>

        <div class="progress-container">
            <div class="timeline" id="timeline"></div>
            <div class="chart-box">
                <canvas id="healthChart"></canvas>
            </div>
        </div>

        <!-- إضافة قسم الإنجازات -->
        <div class="achievements">
            <h3>🏆 الإنجازات</h3>
            <div id="achievementsList"></div>
        </div>

        <button onclick="toggleBenefits()">عرض الفوائد الإضافية</button>
        <div class="benefits" id="benefits">
            <!-- المحتوى السابق -->
        </div>
    </div>

    <script>
        // الإضافات الجديدة
        let chart;
        const achievements = [
            { id: 1, hours: 24, title: "البقاء يوم كامل بدون تدخين" },
            { id: 2, hours: 168, title: "أسبوع من التعافي" },
            { id: 3, hours: 720, title: "شهر من الحرية" },
            { id: 4, hours: 8760, title: "بطل السنة" }
        ];

        function calculateSavings(elapsedHours) {
            const cigsPerDay = parseInt(document.getElementById('cigarettes').value);
            const packPrice = parseInt(document.getElementById('packPrice').value);
            
            const days = elapsedHours / 24;
            const packsPerDay = cigsPerDay / 20;
            const savings = days * packsPerDay * packPrice;
            
            document.getElementById('savings').innerHTML = `
                💵 المدخرات المالية: $${savings.toFixed(2)}
            `;
        }

        function updateChart(elapsedDays) {
            const ctx = document.getElementById('healthChart').getContext('2d');
            
            if(chart) chart.destroy();
            
            chart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['القلب', 'الرئة', 'الدم', 'المناعة', 'الطاقة'],
                    datasets: [{
                        label: 'تحسن الصحة (%)',
                        data: [
                            Math.min(100, elapsedDays * 0.5),
                            Math.min(100, elapsedDays * 0.7),
                            Math.min(100, elapsedDays * 2),
                            Math.min(100, elapsedDays * 1.2),
                            Math.min(100, elapsedDays * 1.5)
                        ],
                        backgroundColor: 'rgba(46, 204, 113, 0.2)',
                        borderColor: '#2ecc71',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        function checkAchievements(elapsedHours) {
            const achieved = achievements.filter(a => elapsedHours >= a.hours);
            const list = document.getElementById('achievementsList');
            list.innerHTML = achieved.map(a => `
                <div class="milestone completed">
                    ${a.title}
                    <span class="achievement-badge">🏅</span>
                </div>
            `).join('');
            
            // إظهار إشعار عند تحقيق إنجاز جديد
            if(achieved.length > document.achievedCount) {
                showNotification(`🎉 مبروك! حققت إنجاز: ${achieved.slice(-1)[0].title}`);
                document.achievedCount = achieved.length;
            }
        }

        function showNotification(message) {
            const notif = document.getElementById('notification');
            notif.textContent = message;
            notif.style.display = 'block';
            setTimeout(() => notif.style.display = 'none', 3000);
        }

        // تعديل الدالة updateTimer
        function updateTimer() {
            const quitDate = new Date(document.getElementById('quitDate').value);
            const now = new Date();
            const elapsed = now - quitDate;
            
            const days = Math.floor(elapsed / (1000 * 60 * 60 * 24));
            const hours = Math.floor((elapsed % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((elapsed % (1000 * 60 * 60)) / (1000 * 60));

            document.getElementById('elapsedTime').innerHTML = `
                ⏳ الوقت المنقضي: ${days} أيام ${hours} ساعات ${minutes} دقائق
            `;

            const elapsedHours = elapsed / 1000 / 60 / 60;
            updateTimeline(elapsedHours);
            calculateSavings(elapsedHours);
            updateChart(days);
            checkAchievements(elapsedHours);
        }

        // بدء التتبع مع التحقق من القيم
        function startTracking() {
            if (!document.getElementById('quitDate').value) {
                showNotification('الرجاء إدخال تاريخ الإقلاع أولاً');
                return;
            }
            document.achievedCount = 0;
            setInterval(updateTimer, 1000);
            updateTimer();
        }
    </script>
</body>
</html>
